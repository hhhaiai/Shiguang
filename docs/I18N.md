# 国际化 (i18n) 指南

本文档描述了 Shiguang 应用的国际化系统架构和使用规范。

## 技术方案

采用 **Flutter 标准 l10n** 方案（`.arb` 文件 + 代码生成），而非自定义 Map 方式。

### 优势

- Flutter 官方推荐
- IDE 自动补全
- 可对接专业翻译平台（Crowdin、Localizely）
- 标准格式，社区成熟
- **原生支持 RTL 语言**（阿拉伯语、希伯来语等）

## 项目结构

```
lib/
├── l10n/
│   ├── app_en.arb          # 英文模板（源语言）
│   ├── app_zh.arb          # 中文（简体）fallback
│   ├── app_zh_Hans.arb     # 中文简体
│   ├── app_zh_Hant.arb     # 中文繁体（台湾）
│   └── generated/          # 生成的代码（勿手动修改）
│       ├── app_localizations.dart
│       ├── app_localizations_en.dart
│       └── app_localizations_zh.dart
├── core/i18n/              # 旧的翻译系统（待迁移）
└── ...
l10n.yaml                   # l10n 配置文件
pubspec.yaml                # flutter.generate: true
```

## 配置说明

### l10n.yaml

```yaml
arb-dir: lib/l10n
template-arb-file: app_en.arb
output-localization-file: app_localizations.dart
output-class: AppLocalizations
output-dir: lib/l10n/generated
nullable-getter: false
```

### pubspec.yaml

```yaml
flutter:
  generate: true
```

## 添加新翻译字符串

### 步骤 1: 在 app_en.arb 中添加键

```json
{
  "@@locale": "en",
  "newString": "New String",
  "@newString": {
    "description": "Description for translators"
  }
}
```

### 步骤 2: 在其他语言文件中添加对应翻译

- `app_zh_Hans.arb` - 简体中文
- `app_zh_Hant.arb` - 繁体中文（台湾）

### 步骤 3: 重新生成代码

```bash
flutter gen-l10n
```

### 步骤 4: 在代码中使用

```dart
import 'package:flutter/material.dart';
import 'l10n/generated/app_localizations.dart';

// 在 Widget 中使用
Text(AppLocalizations.of(context).newString)
```

## 支持的语言

当前已支持：

| 语言 | 代码 | 状态 |
|------|------|------|
| English | en | ✅ 完整 |
| 简体中文 | zh-Hans | ✅ 完整 |
| 繁体中文（台湾）| zh-Hant | ✅ 完整 |
| 繁体中文（香港）| zh-HK | ⚠️ 使用 zh-Hant |
| 西班牙语 | es | ⚠️ 待添加 |

### 计划支持的语言

按优先级分批添加：

#### 第一批：欧洲主要语言
- 西班牙语 (es)
- 法语 (fr)
- 德语 (de)
- 意大利语 (it)
- 葡萄牙语 (pt-PT, pt-BR)
- 荷兰语 (nl)
- 俄语 (ru)
- 波兰语 (pl)

#### 第二批：东亚 + 东南亚
- 日语 (ja)
- 韩语 (ko)
- 越南语 (vi)
- 泰语 (th)
- 印度尼西亚语 (id)

#### 第三批：南亚 + 中东
- 印地语 (hi)
- 阿拉伯语 (ar) - RTL
- 希伯来语 (he) - RTL
- 土耳其语 (tr)

#### 第四批：其他语言
- 其他 70+ 种语言（按需添加）

## 添加新语言

### 步骤 1: 创建 .arb 文件

```bash
# 例如添加西班牙语
cp lib/l10n/app_en.arb lib/l10n/app_es.arb
# 修改 @@locale 为 "es"
# 翻译所有字符串
```

### 步骤 2: 更新 AppLanguage 枚举

在 `lib/features/settings/data/settings_provider.dart` 中添加新语言：

```dart
enum AppLanguage {
  // 现有语言...
  es('es', 'Español'),
  // ...
}
```

### 步骤 3: 更新 app_i18n.dart

修改 `resolveAppLocaleKind` 函数支持新语言。

### 步骤 4: 更新 app.dart

在 `supportedLocales` 列表中添加新语言。

## 代码迁移（旧 → 新）

当前项目使用旧的 `context.t(zhHans: ...)` 方式，需要迁移到新的 l10n 系统。

### 迁移示例

旧代码：
```dart
context.t(zhHans: '设置', zhHant: '設定', en: 'Settings')
```

新代码：
```dart
AppLocalizations.of(context).settings
```

### 迁移策略

1. **渐进式迁移**：新旧系统并存，逐步替换
2. **按功能迁移**：一个页面一个页面迁移
3. **保持兼容性**：旧代码继续工作

## 注意事项

1. **不要手动修改 `generated/` 目录下的文件** - 这些是自动生成的
2. **所有用户可见的字符串都必须添加到 .arb 文件**
3. **使用有意义的键名** - 使用 camelCase，如 `settings`, `userName`
4. **添加描述** - 使用 `@description` 帮助译者理解上下文
5. **测试所有语言** - 确保 UI 在不同语言下正常显示

## 相关文档

- [Flutter 国际化文档](https://docs.flutter.dev/ui/accessibility-and-internationalization/internationalization)
- [l10n.yaml 配置](https://docs.flutter.dev/ui/accessibility-and-internationalization/internationalization)
- [ARB 文件格式](https://github.com/google/app-resource-bundle/wiki/ApplicationResourceBundleSpecification)
